# Makefile for Phoenix Heart Project

# ==============================================================================
# 變數設定
# ==============================================================================
PYTHON = python3

# ==============================================================================
# 主要指令
# ==============================================================================

.PHONY: help lint test-unit test-e2e

help:
	@echo "請使用以下指令:"
	@echo "  make lint          - 使用 ruff 檢查程式碼語法錯誤"
	@echo "  make test-unit     - 執行快速的單元測試"
	@echo "  make test-e2e      - 執行完整的端到端測試 (會需要較長時間)"
	@echo "  make clean         - 清理測試產生的檔案"

# ==============================================================================
# 測試與品質控制
# ==============================================================================

lint:
	@echo "🚀 正在使用 ruff 進行快速語法檢查 (僅限 F-rules)..."
	$(PYTHON) -m ruff check . --select=F --fix

test-unit:
	@echo "🚀 正在執行單元測試..."
	$(PYTHON) -m pytest -m unit

test-e2e:
	@echo "🚀 正在執行端到端測試..."
	bash scripts/smart_e2e_test.sh

# ==============================================================================
# 清理
# ==============================================================================

clean:
	@echo "🧹 正在清理暫存檔案..."
	find . -type f -name '*.pyc' -delete
	find . -type d -name '__pycache__' -delete
	rm -rf .pytest_cache
	rm -rf .venv_*
	rm -rf /tmp/mock_content
	@echo "✅ 清理完成。"
