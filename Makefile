# Makefile for Phoenix Heart Project

# ==============================================================================
# è®Šæ•¸è¨­å®š
# ==============================================================================
PYTHON = python3

# ==============================================================================
# ä¸»è¦æŒ‡ä»¤
# ==============================================================================

.PHONY: help lint test-unit test-e2e

help:
	@echo "è«‹ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤:"
	@echo "  make lint          - ä½¿ç”¨ ruff æª¢æŸ¥ç¨‹å¼ç¢¼èªæ³•éŒ¯èª¤"
	@echo "  make test-unit     - åŸ·è¡Œå¿«é€Ÿçš„å–®å…ƒæ¸¬è©¦"
	@echo "  make test-e2e      - åŸ·è¡Œå®Œæ•´çš„ç«¯åˆ°ç«¯æ¸¬è©¦ (æœƒéœ€è¦è¼ƒé•·æ™‚é–“)"
	@echo "  make clean         - æ¸…ç†æ¸¬è©¦ç”¢ç”Ÿçš„æª”æ¡ˆ"

# ==============================================================================
# æ¸¬è©¦èˆ‡å“è³ªæ§åˆ¶
# ==============================================================================

lint:
	@echo "ğŸš€ æ­£åœ¨ä½¿ç”¨ ruff é€²è¡Œå¿«é€Ÿèªæ³•æª¢æŸ¥ (åƒ…é™ F-rules)..."
	$(PYTHON) -m ruff check . --select=F --fix

test-unit:
	@echo "ğŸš€ æ­£åœ¨åŸ·è¡Œå–®å…ƒæ¸¬è©¦..."
	$(PYTHON) -m pytest -m unit

test-e2e:
	@echo "ğŸš€ æ­£åœ¨åŸ·è¡Œç«¯åˆ°ç«¯æ¸¬è©¦..."
	bash scripts/smart_e2e_test.sh

# ==============================================================================
# æ¸…ç†
# ==============================================================================

clean:
	@echo "ğŸ§¹ æ­£åœ¨æ¸…ç†æš«å­˜æª”æ¡ˆ..."
	find . -type f -name '*.pyc' -delete
	find . -type d -name '__pycache__' -delete
	rm -rf .pytest_cache
	rm -rf .venv_*
	rm -rf /tmp/mock_content
	@echo "âœ… æ¸…ç†å®Œæˆã€‚"
