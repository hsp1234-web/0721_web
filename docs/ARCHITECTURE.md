# 鳳凰之心專案架構 v8.0

本文件詳細說明了鳳凰之心專案的最終技術架構，其核心是圍繞一個統一的智慧啟動器 `scripts/launch.py` 來構建的。

## 1. 全新檔案架構總覽

新架構的核心是職責分離與入口統一。所有程式碼、腳本、依賴和工具都將被歸類到職責明確的資料夾中。

```
/
│
├── 📜 README.md                   # 更新後的專案說明，解釋新架構和啟動方式
│
├── 📦 src/                         # 【核心原始碼】所有微服務的家
│   │
│   ├── 📈 quant/                   # Quant App 的 Python 套件
│   │   ├── __init__.py
│   │   ├── main.py                 # FastAPI 服務入口
│   │   ├── logic/                  # 核心業務邏輯
│   │   └── tests/                  # Quant 相關的測試案例
│   │
│   └── 🎤 transcriber/             # Transcriber App 的 Python 套件
│       ├── __init__.py
│       ├── main.py                 # FastAPI 服務入口
│       ├── logic.py                # 核心業務邏輯
│       └── tests/                  # Transcriber 相關的測試案例
│
├── 🚀 scripts/                     # 【統一操作中心】所有使用者指令的入口
│   │
│   ├── launch.py                   # ✨ 唯一的「智慧啟動器」，適用於所有環境
│   │
│   ├── phoenix_dashboard.py        # ✨ 您精美的「終端機儀表板」程式碼放在這裡
│   │
│   └── tests/                      # 針對腳本的單元測試
│       └── test_launch.py
│
├── 🛠️ tools/                        # 【內建工具庫】存放專案依賴的輔助工具
│   │
│   └── gotty                       # GoTTY 的 Linux 執行檔，用於將儀表板 Web 化
│
├── 📋 requirements/                # 【集中依賴管理】
│   │
│   ├── base.txt                    # 所有服務共享的基礎依賴 (如 pytest, httpx)
│   ├── quant.txt                   # Quant App 的特定依賴
│   └── transcriber.txt             # Transcriber App 的特定依賴 (包含 .large)
│
├── ⚙️ proxy/                        # (不變) 逆向代理設定
│   └── proxy_config.json
│
├── 📚 docs/                        # (不變) 專案文件
│
└── 🗄️ ALL_DATE/                     # (不變) 封存的參考資料
    └── ...
```

## 2. 儀表板整合方案詳解

精美的儀表板 (`scripts/phoenix_dashboard.py`) 是整個體驗的核心。在新的架構中，它將被賦予一個清晰的定位並與啟動流程完美整合。

### 儀表板的職責

`scripts/phoenix_dashboard.py` 的職責非常純粹——它就是那個視覺化儀表板本身。它負責：

-   **繪製介面**：使用 ANSI Escape Codes 繪製 TUI。
-   **監控硬體**：顯示 CPU、RAM、DISK 使用率。
-   **觸發與監控**：協調每個微服務的環境準備、依賴安裝和測試流程。
-   **管理後端微服務的生命週期**。

### 啟動與整合機制

使用者不再直接運行儀表板檔案，而是透過 `scripts/launch.py --dashboard` 來召喚它。

`launch.py` 在儀表板模式下的行為如下：

1.  **呼叫翻譯官**: `launch.py` 執行一個內部指令，呼叫 `tools/gotty` 工具。
2.  **包裹儀表板**: `gotty` 會去執行 `scripts/phoenix_dashboard.py`，並將儀表板的所有終端機畫面即時轉譯成一個網頁服務（例如，運行在 8080 埠）。
3.  **健康檢查與重試**: `launch.py` 會耐心等待，透過智慧重試機制確認這個由 GoTTY 建立的網頁服務已經完全就緒。
4.  **自動嵌入畫面**:
    -   **在 Colab 中**: 一旦確認就緒，`launch.py` 會獲取 Colab 的原生代理網址，並使用 `IPython.display.IFrame` 技術，將這個動態的儀表板網頁直接嵌入到 Colab 的輸出儲存格中。
    -   **在本地**: `launch.py` 會在終端顯示儀表板的本地網址 (`http://localhost:8080`)，並保持運行。

## 3. Colab 單一儲存格最終呈現草圖

### 執行前

使用者只會看到一個帶有設定表單的儲存格。

```
+---------------------------------------------------------------------------------+
| ▲ 💎 鳳凰之心指揮中心：一鍵啟動                                                 |
|---------------------------------------------------------------------------------|
| > 完成設定後，點擊左側的 ▶️ 執行按鈕即可啟動。                                     |
| ---                                                                             |
| 啟動模式: [ 啟動視覺化儀表板 ▼]                                                 |
| ... (其他可選設定) ...                                                          |
| ---                                                                             |
|                                                                                 |
| [▶️] # 唯一的啟動指令，會自動讀取上方表單的設定                                  |
|     !python scripts/launch.py --dashboard                                       |
|                                                                                 |
+---------------------------------------------------------------------------------+
```

### 執行後

儲存格的輸出區域會自動更新，直接顯示嵌入的儀表板。

```
+---------------------------------------------------------------------------------+
| ▼ 💎 鳳凰之心指揮中心：一鍵啟動                                                 |
|---------------------------------------------------------------------------------|
| ... (設定表單在此處被折疊) ...                                                  |
|                                                                                 |
| [🔄] # ... (啟動指令在此處被折疊) ...                                            |
|---------------------------------------------------------------------------------|
| [OUTPUT]                                                                        |
|                                                                                 |
|   ┌─ 🚀 鳳凰之心指揮中心 v8.0 ─────────────────────────────────────────────────┐   |
|   │                                                                              │   |
|   ├─ 🌐 系統狀態 (System Status) ────────────────────────────────────────────────┤   |
|   │ 🟢 運行中   核心: 8   RAM: 12.1/16.0 GB (75.6%)   DISK: 25.4/100.0 GB (25.4%) │   |
|   │                                                                              │   |
|   ├─ 📦 應用程式狀態 (Application Status) ───────────────────────────────────────┤   |
|   │ 📈 Quant App        [🟢 測試通過]      🎤 Transcriber App  [🔄 安裝中...]         │   |
|   │                                                                              │   |
|   ├─ 📜 即時日誌 (Live Logs) ────────────────────────────────────────────────────┤   |
|   │ [10:17:25] [INFO] Quant App 測試完成: 4 passed in 5.15s                     │   |
|   │ [10:17:21] [INFO] 正在為 Transcriber App 安裝大型依賴...                      │   |
|   │                                                                              │   |
|   ├─ ✨ 當前任務 (Current Task) ─────────────────────────────────────────────────┤   |
|   │ [安裝依賴於 Transcriber]                                                     │   |
|   │ torch 2.1.0      [━╸      ] 25% - 500.1/2000.0 MB @ 100.2 MB/s          │   |
|   │                                                                              │   |
|   └──────────────────────────────────────────────────────────────────────────────┘   |
|                                                                                 |
+---------------------------------------------------------------------------------+
```

## 4. 總結：新架構的優勢

-   **極致簡潔**: 使用者只需面對 `scripts/launch.py` 這一個入口，所有複雜性都被封裝在後端。
-   **職責明確**: `src/` 專注業務，`scripts/` 專注操作，`tools/` 專注輔助，結構一目了然。
-   **無縫體驗**: 無論是在 Ubuntu 還是 Colab，啟動服務或儀表板的指令完全一致，徹底消除了環境切換的困擾。
-   **完美視覺**: 透過「Web 化 + 自動嵌入」的策略，精心設計的儀表板得以在 Colab 中無需點擊、即時呈現，提供了與本地開發完全一致的精美互動體驗。
