# 鳳凰之心架構設計

本文檔詳細描述了「鳳凰之心」專案的軟體架構、設計原則和核心組件。

## 1. 設計哲學

- **關注點分離 (Separation of Concerns)**: 每個組件（應用、日誌、監控）都有明確且單一的職責。
- **可擴展性 (Scalability)**: 新的功能模組（Apps）可以作為獨立的單元進行開發和部署，而無需修改核心系統。
- **可維護性 (Maintainability)**: 清晰、一致的結構和編碼風格，使得理解、修改和除錯變得更加容易。
- **環境適應性 (Adaptability)**: 專案設計旨在同時簡化在本地開發、Colab 雲端執行和生產環境部署的流程。

## 2. 高層架構圖

```
+--------------------------------------------------+
|      使用者 (透過瀏覽器或 Colab)                 |
+------------------------+-------------------------+
                         |
                         v
+--------------------------------------------------+
|      Colab 環境 / 本地開發環境                   |
|                                                  |
|  +--------------------------------------------+  |
|  |     啟動器 (colab_run.py)                  |  |
|  +----------------------+---------------------+  |
|                         | 啟動                  |
|                         v                       |
|  +--------------------------------------------+  |
|  |     核心應用 (main.py) - FastAPI           |  |
|  |                                            |  |
|  |  +-----------------+  +------------------+  |  |
|  |  |   API 路由器     |  |   模板引擎        |  |
|  |  +-------+---------+  +------------------+  |  |
|  |          | 動態加載                      |  |
|  |          v                               |  |
|  |  +-------------------------------------+   |  |
|  |  |      apps/ 目錄                     |   |  |
|  |  | +-----------+ +-----------+         |   |  |
|  |  | | transcriber | |  quant  | ...     |   |  |
|  |  | +-----------+ +-----------+         |   |  |
|  |  +-------------------------------------+   |  |
|  +--------------------------------------------+  |
+--------------------------------------------------+
```

## 3. 核心組件詳解

### 3.1. `WEB/` - 專案根目錄

所有與專案相關的程式碼、文件和資源都存放在這個目錄下，保持了專案的整潔和獨立性。

### 3.2. `colab_run.py` - Colab 啟動器

- **職責**: 作為在 Google Colab 環境中啟動整個應用的入口點。它負責處理 Colab 特有的設定，並啟動核心的 FastAPI 應用。
- **特色**: 內建一個純文字的儀表板，可以在 Colab 的輸出單元格中即時顯示系統狀態、日誌和資源使用情況，提供了卓越的互動式監控體驗。

### 3.3. `main.py` - 核心應用

- **職責**: 這是基於 FastAPI 的核心 Web 伺服器。它負責：
    - 初始化日誌系統。
    - 設定模板引擎以渲染 HTML 頁面。
    - 動態掃描 `apps/` 目錄，並將所有子應用的 API 路由掛載到主應用中。
- **生命週期管理**: 使用 FastAPI 的 `lifespan` 事件來確保在伺服器啟動時和關閉時能正確地執行初始化和清理任務。

### 3.4. `apps/` - 可插拔業務模組

- **職責**: 存放所有獨立的業務邏輯單元。每個子目錄都代表一個功能模組（例如，`transcriber` 負責語音轉錄，`quant` 負責數據分析）。
- **設計**: 每個 App 都是一個獨立的 FastAPI `APIRouter`，可以擁有自己的路徑、模型和邏輯。這種設計使得新增或移除功能變得非常簡單，只需添加或刪除對應的資料夾即可。

### 3.5. `templates/` - UI 模板

- **職責**: 存放所有 Jinja2 HTML 模板。目前主要包含 `dashboard.html`，這是使用者與應用互動的主介面。

### 3.6. `docs/` - 文件中心

- **職責**: 存放所有專案相關的說明文件，包括架構設計 (`ARCHITECTURE.md`)、Colab 使用指南 (`Colab_Guide.md`) 和測試日誌 (`TEST.md`)。

### 3.7. `requirements.txt` - 依賴清單

- **職責**: 統一定義了專案在所有環境下運作所需的 Python 套件。

## 4. 啟動流程

1.  **使用者** 在 Colab 儲存格中執行 `colab_run.py` 的啟動程式碼。
2.  **`colab_run.py`** 開始執行：
    - 建立並啟動其內建的儀表板 UI。
    - 在一個獨立的背景執行緒中，使用 `subprocess` 啟動 `main.py`。
3.  **`main.py`** 開始執行：
    - 設定日誌系統，將日誌同時輸出到控制台和檔案。
    - 掃描 `apps/` 目錄，找到所有子應用並加載它們的 API 路由。
    - 啟動 `uvicorn` 伺服器，開始監聽 HTTP 請求。
4.  **`colab_run.py`** 偵測到 `main.py` 成功啟動後，會獲取 Colab 分配的公開 URL，並將其顯示在儀表板上。
5.  **使用者** 點擊儀表板上的連結，即可在瀏覽器中開啟並使用 Web 應用。
