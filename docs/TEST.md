# 測試計畫與執行指南 v2.0

**文件作者：** Jules (AI 軟體工程師)
**最後更新：** 2025年7月28日

## 一、 核心理念：開發與自動化的雙軌測試策略

本專案採用雙軌測試策略，以滿足不同場景下的需求：

1.  **互動式儀表板 (用於開發與除錯):**
    *   **工具:** `scripts/phoenix_dashboard.py`
    *   **策略:** 提供一個視覺化的 TUI 儀表板，允許開發者**手動**、**獨立地**對每個微服務（`quant`, `transcriber`）進行環境準備和測試。
    *   **優勢:** 每個服務都在**隔離的虛擬環境**中進行測試，環境乾淨，互不干擾，非常適合開發階段的功能驗證和問題排查。

2.  **自動化端對端測試 (用於 CI/CD):**
    *   **工具:** `scripts/run_e2e_tests.sh`
    *   **策略:** 一個全自動化的 Shell 腳本，模擬真實的部署環境。它會將**所有**微服務的依賴安裝到**同一個共享的** Python 環境中，然後啟動所有服務，最後執行 `pytest` 進行整合測試。
    *   **優勢:** 快速、無需人工介入，能有效檢查出服務間的整合問題，是 CI/CD 流程中保證程式碼品質的關鍵防線。

---

## 二、 如何執行測試

### **選項 A：互動式儀表板 (建議開發時使用)**

此模式提供最精細的控制和最清晰的視覺回饋。

1.  **啟動儀表板:**
    在專案根目錄下，執行 `launch.py` 並附帶 `--dashboard` 旗標。

    ```bash
    python scripts/launch.py --dashboard
    ```

2.  **操作:**
    *   儀表板將會啟動，並自動開始為 `quant` 和 `transcriber` 兩個服務準備環境並執行其各自的測試。
    *   您可以在儀表板上即時監控安裝進度、測試結果和日誌輸出。
    *   此模式使用 `uv` 為每個服務建立獨立的虛擬環境 (`.venv_visual`)，確保環境隔離。

### **選項 B：自動化端對端測試 (建議在 CI/CD 或提交前使用)**

此模式用於快速驗證整個系統的整合健康狀況。

1.  **執行腳本:**
    在專案根目錄下，直接執行 Shell 腳本：

    ```bash
    bash scripts/run_e2e_tests.sh
    ```

2.  **執行流程詳解:**
    該腳本會自動完成以下所有步驟：
    a. **安裝依賴:** 將 `requirements/` 目錄下的所有依賴 (`base.txt`, `quant.txt`, `transcriber.txt`) 安裝到當前的 Python 環境中。
    b. **啟動服務:** 在背景執行 `python scripts/launch.py`，同時啟動 `quant` 和 `transcriber` 兩個微服務。
    c. **健康檢查:** 透過 `curl` 指令輪詢檢查，確保兩個服務的 API (埠 8001 和 8002) 都已成功啟動並可接受請求。
    d. **執行測試:** 執行 `pytest src/`，運行 `src` 目錄下所有符合 `test_*.py` 命名規則的測試檔案。
    e. **自動清理:** 測試結束後，腳本會自動關閉所有在背景啟動的服務。

---

## 三、 測試報告與持續改進

*   `quant` 服務的測試 (`src/quant/tests/`) 已包含對核心業務邏輯的模擬 (mock) 測試。
*   `transcriber` 服務的測試 (`src/transcriber/tests/`) 目前僅包含基礎的 API "點火" 測試。未來的改進方向是增加對完整轉寫流程（上傳 -> 處理 -> 查詢結果）的端對端測試，並對耗時的轉寫邏輯進行模擬。

強烈建議在對程式碼進行重大修改後，至少執行一次自動化端對端測試，以確保沒有引入迴歸性錯誤。
