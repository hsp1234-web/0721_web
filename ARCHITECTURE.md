# 系統架構與執行模式詳解

本文檔詳細說明了本專案的系統架構、執行模式、檔案功能及所使用的技術。

## 1. 核心設計哲學：職責分離與日誌中心化

本系統的核心設計哲學是嚴格的「職責分離」。每個元件只做一件事，並把它做好。系統的狀態和歷史記錄，則由一個中心化的日誌系統來統一管理。

- **後端 (Backend)**：只負責處理業務邏輯和 API 請求。它不關心日誌如何顯示，只負責「忠實記錄」。
- **前端 (Frontend/Colab)**：只負責顯示資訊。它不直接執行業務邏輯，而是透過讀取中心化的日誌來了解系統狀態。
- **日誌系統 (Logging System)**：作為後端和前端之間的橋樑，是系統狀態的唯一真實來源。

## 2. 技術棧

- **後端**：
    - **FastAPI**: 一個現代、高效能的 Python Web 框架，用於建立 API。
    - **Uvicorn**: 一個 ASGI 伺服器，用於在生產環境中運行 FastAPI 應用。
    - **SQLite**: 一個輕量級的、無伺服器的 SQL 資料庫引擎，用於儲存日誌。
- **前端 (Colab)**：
    - **IPython/Jupyter**: Colab 的核心，提供了互動式的 Python 環境。
    - **ipywidgets**: 用於在 Colab 中建立互動式的 UI 元件（如日誌面板、狀態標籤）。
- **依賴管理**：
    - **Poetry**: 一個現代的 Python 依賴管理和打包工具。

## 3. 專案檔案結構與功能

```
.
├── ARCHITECTURE.md         # 本架構文件
├── integrated_platform/
│   ├── pyproject.toml      # Poetry 的專案設定檔
│   ├── poetry.lock         # 鎖定的依賴版本
│   └── src/
│       ├── main.py         # FastAPI 應用程式的核心
│       └── ...
├── run.sh                  # 後端部署腳本
└── test.sh                 # 測試腳本
```

### 3.1. `run.sh`：後端部署腳本

- **職責**：準備 Python 環境並啟動後端伺服器。
- **技術細節**：
    - 使用 `poetry run` 執行 `uvicorn` 伺服器。

### 3.2. `test.sh`：測試腳本

- **職責**：啟動伺服器，執行測試，然後關閉伺服器。
- **技術細節**：
    - 在背景啟動 `uvicorn` 伺服器。
    - 使用 `pytest` 執行測試。
    - 關閉伺服器。

### 3.3. `integrated_platform/src/main.py`：FastAPI 應用程式

- **職責**：提供後端的 API 端點。
- **執行模式**：由 Uvicorn 伺服器載入和運行。

## 4. 執行流程總結

1.  **開發者** 執行 `./run.sh` 來啟動後端伺服器。
2.  **開發者** 執行 `./test.sh` 來驗證系統功能。
3.  FastAPI 伺服器處理請求，並將日誌寫入 `logs.sqlite`。
4.  前端應用程式 (例如 Colab) 可以讀取 `logs.sqlite` 來顯示系統狀態。

這種架構確保了後端和前端的解耦，並提供了一個中心化的日誌系統來追蹤所有活動。
