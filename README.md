# 🚀 鳳凰之心 (Phoenix Heart) 專案 v12 - 智慧型系統 🚀

歡迎來到鳳凰之心，一個從單體架構中浴火重生的現代化微服務專案。本專案現已進化至 v12，搭載了完整的**智慧型資源管理與部署系統**、**多模式啟動器**，並**全面鎖定了依賴版本**，以達到企業級的穩定性。

它不僅是一個展示微服務化的範例，更是一個具備高度穩定性、資源感知與自動化能力的專業開發框架。

---

## 一、 核心理念與工具 (Core Philosophy & Tools)

我們的架構基於以下五大核心理念：

- **微服務架構 (Microservices)**: 每個 App (`quant`, `transcriber`) 都是一個獨立、可自行運行的 FastAPI 服務。
- **完全隔離 (Total Isolation)**: 每個 App 擁有自己獨立的虛擬環境，由主啟動腳本自動管理，彼此絕不干擾。
- **【新】可預測的環境 (Predictable Environments)**: 每個 App 的依賴由其 `requirements.txt` **精確鎖定版本**。這確保了每次部署的環境都完全一致，杜絕了因依賴庫更新而導致的非預期錯誤。
- **智慧型資源管理 (Intelligent Resource Management)**: 在安裝**每一個**套件前，系統都會即時檢查記憶體與磁碟資源，確保不會因資源耗盡而中斷。
- **多模式啟動 (Multi-Mode Launcher)**: 提供多種啟動模式，滿足從快速開發驗證到完整生產部署的各種需求。

### 核心工具鏈:

- **`phoenix_starter.py` (推薦)**: 專案的**視覺化啟動器**。
- **`launch.py`**: 專案的**主啟動腳本 (無介面)**，適合在伺服器環境執行。現在支援多種模式。
- **`smart_e2e_test.py`**: 新一代**智能測試指揮官 (Python版)**，用於執行完整的端對端健康檢查。
- **`run/colab_runner.py`**: **Colab Rich 儀表板啟動器 (v15)**，提供三種啟動模式選項。
- **`core_utils/`**: 核心工具模組。
- **`config/resource_settings.yml`**: **全域資源設定中心**。
- **`docs/LESSONS_LEARNED.md`**: **【新】經驗教訓**，記錄了專案開發過程中的重要決策和學習。

---

## 二、 如何開始 (Getting Started)

### 2.1. Google Colab 使用指南 (推薦)

請直接使用 `run/colab_runner.py`。它提供了最佳化的「一鍵啟動」體驗，並提供三種運行模式：

1.  **🚀 自動自檢模式 (Self-Check Mode)**
    *   **用途**: 在不啟動 Web 服務的情況下，對整個專案進行一次完整的健康檢查。
    *   **流程**: 此模式會自動執行 `smart_e2e_test.py`，包括建立虛擬環境、安裝所有鎖定版本的依賴、運行所有測試。
    *   **優點**: 這是驗證程式碼變更或在新環境中首次部署時，確認系統完整性的最佳方式。

2.  **⚡ 快速驗證模式 (Fast-Test Mode)**
    *   **用途**: 用於快速驗證 Colab 前後端的核心通訊流程是否正常。
    *   **流程**: 跳過所有耗時的安裝和測試步驟，在幾秒鐘內模擬一個成功的啟動。
    *   **優點**: 當您只想快速獲取儀表板 URL 並進行前端開發時，此模式非常有用。

3.  **🌍 完整部署模式 (Full-Deploy Mode)**
    *   **用途**: 啟動所有微服務，用於實際的應用程式操作。
    *   **流程**: 執行完整的、穩健的循序安裝與啟動流程，最終提供可操作的 Web 儀表板。
    *   **注意**: 此過程可能需要較長時間，因為它會安裝所有依賴。

### 2.2. 本地/伺服器環境啟動

若您在本地端或伺服器上開發，可以直接使用 `launch.py` 搭配環境變數來控制啟動模式：

- **執行完整健康檢查**:
  ```bash
  SELF_CHECK_MODE=true python launch.py
  ```

- **執行完整部署**:
  ```bash
  python launch.py
  ```

---

## 三、 重要經驗傳承：為何鎖定依賴版本？

在專案的早期版本中，我們的 `requirements.txt` 並未鎖定具體版本 (例如，只寫 `fastapi` 而非 `fastapi==0.116.1`)。這導致了一個嚴重的**技術債務**：

> **問題**: 當 `fastapi` 或任何其他依賴庫發布了一個不向下相容的更新時，我們的部署流程會自動拉取最新版本，從而導致應用程式在我們毫無準備的情況下崩潰。

為了建立一個穩定、可預測的生產級系統，我們採取了**依賴版本鎖定**的最佳實踐。這確保了無論何時何地部署，所使用的環境都是完全一致的。

更多關於此決策的詳細討論，請參閱 **`docs/LESSONS_LEARNED.md`**。

---

## 四、 檔案結構總覽 (v12)

```
/PHOENIX_HEART_PROJECT/
│
├── 🚀 launch.py                   # 【核心】主啟動腳本，支援多模式。
├── 🧪 smart_e2e_test.py            # 【核心】智能端對端測試腳本。
│
├── 📦 apps/                        # 所有微服務
│   └── ...
│
├── 🛠️ core_utils/                 # 核心工具
│
├── ⚙️ config/                     # 全域設定
│
├── 📝 logs/                        # 日誌中心
│
├── 🧪 tests/                       # 測試中心
│
├── 🏃 run/                         # 【Colab】啟動器
│   └── colab_runner.py
│
├── 📚 docs/                         # 【文件】
│   └── LESSONS_LEARNED.md        # 【新】經驗教訓
│
└── 📄 .gitignore
```
