# Colab ä½¿ç”¨è€…æŒ‡å—ï¼šé³³å‡°ä¹‹å¿ƒä½œæˆ°å¹³å°

## ç°¡ä»‹

æ­¡è¿ä½¿ç”¨ã€Œé³³å‡°ä¹‹å¿ƒã€ä½œæˆ°å¹³å°ï¼æœ¬å¹³å°å°ˆç‚ºåœ¨ Google Colab ç’°å¢ƒä¸­ç©©å®šã€å¯é åœ°é‹è¡Œ Web æœå‹™è€Œè¨­è¨ˆã€‚é€éæˆ‘å€‘æä¾›çš„ Colab ç­†è¨˜æœ¬ï¼Œæ‚¨å¯ä»¥é€éä¸€å€‹ç°¡å–®çš„è¡¨å–®ä»‹é¢ä¾†è¨­å®šä¸¦ä¸€éµå•Ÿå‹•æ‚¨çš„æœå‹™ã€‚

å¹³å°æœƒè‡ªå‹•è™•ç†ï¼š

*   ä½¿ç”¨ `uv` é€²è¡Œé«˜é€Ÿä¾è³´å®‰è£ã€‚
*   å•Ÿå‹•å¾Œç«¯ FastAPI æœå‹™ã€‚
*   ä½¿ç”¨ Google Colab çš„å…§å»ºä»£ç†åŠŸèƒ½ï¼Œç”Ÿæˆä¸€å€‹**å®‰å…¨ã€ç§æœ‰**çš„æ‡‰ç”¨ç¨‹å¼é€£çµã€‚

## Colab å•Ÿå‹•ä»‹é¢

å°‡ä¸‹æ–¹çš„ç¨‹å¼ç¢¼å„²å­˜æ ¼è¤‡è£½åˆ°æ‚¨çš„ Colab ç­†è¨˜æœ¬ä¸­ã€‚åŸ·è¡Œå¾Œï¼Œæ‚¨æœƒçœ‹åˆ°ä¸€å€‹å¯äº’å‹•çš„è¡¨å–®ã€‚

### å¦‚ä½•è¨­å®š

åœ¨åŸ·è¡Œå„²å­˜æ ¼ä¹‹å‰ï¼Œè«‹æ ¹æ“šæ‚¨çš„éœ€æ±‚è¨­å®šä»¥ä¸‹åƒæ•¸ï¼š

#### 1. é¡¯ç¤ºåå¥½è¨­å®š
> **åœ¨å•Ÿå‹•å‰ï¼Œè¨­å®šæ‚¨çš„æˆ°æƒ…å®¤é¡¯ç¤ºåå¥½ã€‚**

*   `LOG_DISPLAY_LINES`: (å³å°‡å¯¦è£) è¨­å®šæ—¥èªŒå„€è¡¨æ¿ä¸­é¡¯ç¤ºçš„æ—¥èªŒè¡Œæ•¸ã€‚
*   `STATUS_REFRESH_INTERVAL`: (å³å°‡å¯¦è£) è¨­å®šç‹€æ…‹é¢æ¿çš„åˆ·æ–°é »ç‡ï¼ˆç§’ï¼‰ã€‚

#### 2. å°ˆæ¡ˆèˆ‡ä¼ºæœå™¨è¨­å®š
> **`PROJECT_FOLDER_NAME` æ˜¯æ‚¨åœ¨ `/content/` ä¸‹çš„å°ˆæ¡ˆè³‡æ–™å¤¾åç¨±ã€‚**

*   `PROJECT_FOLDER_NAME`: é€™æ˜¯æ‚¨å­˜æ”¾æ•´å€‹å°ˆæ¡ˆçš„è³‡æ–™å¤¾åç¨±ã€‚
    *   å¦‚æœæ‚¨æ˜¯é€é `git clone https://github.com/user/repo.git WEB` å…‹éš†çš„ï¼Œé‚£é€™è£¡å°±å¡« `WEB`ã€‚
    *   å¦‚æœæ‚¨å°‡å°ˆæ¡ˆæ”¾åœ¨ Google Drive çš„ `MyDrive/MyProject` ä¸­ï¼Œä¸¦å·²æ›è¼‰ Driveï¼Œé‚£é€™è£¡å°±å¡« `drive/MyDrive/MyProject`ã€‚
*   `FASTAPI_PORT`: æ‚¨çš„å¾Œç«¯ FastAPI æ‡‰ç”¨ç¨‹å¼å°‡åœ¨æ­¤åŸ è™Ÿä¸Šé‹è¡Œã€‚`colab_run.py` æœƒå°‡é€™å€‹åŸ è™Ÿæš´éœ²çµ¦ Colab çš„ä»£ç†ã€‚é è¨­å€¼ç‚º `8000`ã€‚

### å•Ÿå‹•å„²å­˜æ ¼ç¨‹å¼ç¢¼ (v15.0)

<details>
<summary>é»æ­¤å±•é–‹/æ”¶åˆ ğŸš€ å•Ÿå‹•é³³å‡°ä¹‹å¿ƒæ•´åˆå¼æŒ‡æ®ä¸­å¿ƒ çš„ç¨‹å¼ç¢¼</summary>

```python
#@title ğŸ’ é³³å‡°ä¹‹å¿ƒæ•´åˆå¼æŒ‡æ®ä¸­å¿ƒ v15.0 (ç²¾ç°¡ç‰ˆ) { vertical-output: true, display-mode: "form" }
#@markdown ---
#@markdown ### **1. é¡¯ç¤ºåå¥½è¨­å®š**
#@markdown > **åœ¨å•Ÿå‹•å‰ï¼Œè¨­å®šæ‚¨çš„æˆ°æƒ…å®¤é¡¯ç¤ºåå¥½ã€‚**
#@markdown ---
#@markdown **æ—¥èªŒé¡¯ç¤ºè¡Œæ•¸ (LOG_DISPLAY_LINES)**
#@markdown > **è¨­å®šä¸ŠåŠéƒ¨ã€Œè¿‘æœŸäº‹ä»¶æ‘˜è¦ã€æœ€å¤šé¡¯ç¤ºçš„æ—¥èªŒè¡Œæ•¸ã€‚**
LOG_DISPLAY_LINES = 100 #@param {type:"integer"}
#@markdown **ç‹€æ…‹åˆ·æ–°é »ç‡ (ç§’) (STATUS_REFRESH_INTERVAL)**
#@markdown > **è¨­å®šä¸‹åŠéƒ¨ã€Œå³æ™‚ç‹€æ…‹æŒ‡ç¤ºç‡ˆã€çš„åˆ·æ–°é–“éš”ï¼Œå¯ç‚ºå°æ•¸ (ä¾‹å¦‚ 0.5)ã€‚**
STATUS_REFRESH_INTERVAL = 0.5 #@param {type:"number"}

#@markdown ---
#@markdown ### **2. å°ˆæ¡ˆè·¯å¾‘èˆ‡ä¼ºæœå™¨è¨­å®š**
#@markdown > **è«‹æŒ‡å®šè¦åŸ·è¡Œå¾Œç«¯ç¨‹å¼ç¢¼çš„è³‡æ–™å¤¾åç¨±ã€‚**
#@markdown ---
#@markdown **æŒ‡å®šå°ˆæ¡ˆè³‡æ–™å¤¾åç¨± (TARGET_FOLDER_NAME)**
#@markdown > **è«‹è¼¸å…¥åŒ…å«æ‚¨å¾Œç«¯ç¨‹å¼ç¢¼ (ä¾‹å¦‚ `main.py`, `colab_run.py`) çš„è³‡æ–™å¤¾åç¨±ã€‚ä¾‹å¦‚ï¼š`WEB`ã€‚**
TARGET_FOLDER_NAME = "WEB" #@param {type:"string"}
#@markdown **æ—¥èªŒæ­¸æª”è³‡æ–™å¤¾ (ARCHIVE_FOLDER_NAME)**
#@markdown > **æœ€çµ‚çš„ .txt æ—¥èªŒå ±å‘Šå°‡å„²å­˜æ–¼æ­¤ç¨ç«‹çš„ä¸­æ–‡è³‡æ–™å¤¾ã€‚**
ARCHIVE_FOLDER_NAME = "ä½œæˆ°æ—¥èªŒæ­¸æª”" #@param {type:"string"}
#@markdown **å¾Œç«¯æœå‹™åŸ è™Ÿ (FASTAPI_PORT)**
#@markdown > **å¾Œç«¯ FastAPI æ‡‰ç”¨ç¨‹å¼ç›£è½çš„åŸ è™Ÿã€‚**
FASTAPI_PORT = 8000 #@param {type:"integer"}
#@markdown ---
#@markdown > **æº–å‚™å°±ç·’å¾Œï¼Œé»æ“Šæ­¤å„²å­˜æ ¼å·¦å´çš„ã€ŒåŸ·è¡Œã€æŒ‰éˆ•ã€‚**
#@markdown ---

# ==============================================================================
#                      ğŸš€ æ ¸å¿ƒå•Ÿå‹•å™¨ (è«‹å‹¿ä¿®æ”¹) ğŸš€
# ==============================================================================
import os
import sys
from pathlib import Path

# --- æ­¥é©Ÿ 1: çµ„è£è¨­å®š ---
config = {
    "log_display_lines": LOG_DISPLAY_LINES,
    "status_refresh_interval": STATUS_REFRESH_INTERVAL,
    "archive_folder_name": ARCHIVE_FOLDER_NAME,
    "fastapi_port": FASTAPI_PORT,
}

# --- æ­¥é©Ÿ 2: åˆ‡æ›è·¯å¾‘ä¸¦é©—è­‰ ---
project_path = Path(f"/content/{TARGET_FOLDER_NAME}")
if not project_path.is_dir():
    print(f"âŒ è‡´å‘½éŒ¯èª¤ï¼šæ‰¾ä¸åˆ°å°ˆæ¡ˆè³‡æ–™å¤¾ '{project_path}'ã€‚")
    print("   è«‹ç¢ºèªæ‚¨å·²å°‡å°ˆæ¡ˆä¸Šå‚³æˆ– clone åˆ°æ­£ç¢ºçš„ä½ç½®ï¼Œä¸¦ä¸” TARGET_FOLDER_NAME è¨­å®šæ­£ç¢ºã€‚")
else:
    os.chdir(project_path)
    if str(project_path) not in sys.path:
        sys.path.insert(0, str(project_path))

    # --- æ­¥é©Ÿ 3: å‘¼å«å¾Œç«¯æ©‹æ¥å™¨ ---
    try:
        # å¾å°ˆæ¡ˆä¸­å°å…¥çœŸæ­£çš„åŸ·è¡Œå™¨
        from colab_run import main as run_phoenix_engine

        # åŸ·è¡Œä¸»æµç¨‹ï¼Œå‚³å…¥è¨­å®š
        run_phoenix_engine(config)

    except ImportError:
        print(f"âŒ è‡´å‘½éŒ¯èª¤ï¼šç„¡æ³•å°å…¥ `colab_run` æ¨¡çµ„ã€‚")
        print(f"   è«‹æª¢æŸ¥æª”æ¡ˆ `colab_run.py` æ˜¯å¦å­˜åœ¨æ–¼ '{project_path}' ä¸­ä¸”ç„¡èªæ³•éŒ¯èª¤ã€‚")
    except Exception as e:
        import traceback
        print(f"ğŸ’¥ åŸ·è¡ŒæœŸé–“ç™¼ç”Ÿæœªé æœŸçš„åš´é‡éŒ¯èª¤: {e}")
        traceback.print_exc()
    finally:
        # --- æ­¥é©Ÿ 4: æœ€çµ‚æ­¸æª”è¤‡è£½ ---
        print("\n--- æ­£åœ¨åŸ·è¡Œæœ€çµ‚æ­¸æª”è¤‡è£½... ---")
        try:
            import shutil

            # å‹•æ…‹æ§‹å»ºæºè·¯å¾‘(åœ¨å°ˆæ¡ˆè³‡æ–™å¤¾å…§)å’Œç›®æ¨™è·¯å¾‘(åœ¨/contentæ ¹ç›®éŒ„ä¸‹)
            source_dir = project_path / ARCHIVE_FOLDER_NAME
            destination_dir = Path("/content") / ARCHIVE_FOLDER_NAME

            if source_dir.is_dir():
                if destination_dir.exists():
                    shutil.rmtree(destination_dir)
                shutil.copytree(source_dir, destination_dir)
                print(f"âœ… æˆåŠŸå°‡ '{source_dir.name}' è¤‡è£½åˆ° /content ç›®éŒ„ä¸‹ã€‚")
            else:
                print(f"âš ï¸ è­¦å‘Šï¼šåœ¨å°ˆæ¡ˆè³‡æ–™å¤¾ä¸­æ‰¾ä¸åˆ°æ­¸æª”ç›®éŒ„ '{source_dir}'ï¼Œè·³éè¤‡è£½ã€‚")
        except Exception as e:
            print(f"âŒ è¤‡è£½æ­¸æª”æ™‚ç™¼ç”ŸéŒ¯èª¤: {e}")

```
</details>

## åŸ·è¡Œèˆ‡è¨ªå•

1.  **è¨­å®šåƒæ•¸**ï¼šæ ¹æ“šæ‚¨çš„å°ˆæ¡ˆä½ç½®å’Œåå¥½ï¼Œå¡«å¯«è¡¨å–®ä¸­çš„å››å€‹æ¬„ä½ã€‚
2.  **åŸ·è¡Œå„²å­˜æ ¼**ï¼šé»æ“Šå„²å­˜æ ¼å·¦å´çš„ã€Œæ’­æ”¾ã€æŒ‰éˆ•ã€‚
3.  **æŸ¥çœ‹è¼¸å‡º**ï¼šç¨‹å¼å°‡é–‹å§‹åŸ·è¡Œï¼Œä¸¦ä¾åºæ‰“å°å‡ºï¼š
    *   å·¥ä½œç›®éŒ„åˆ‡æ›ç¢ºèªã€‚
    *   å•Ÿå‹•åƒæ•¸ç¢ºèªã€‚
    *   ä¾è³´å®‰è£æ—¥èªŒã€‚
    *   FastAPI ä¼ºæœå™¨å•Ÿå‹•æ—¥èªŒã€‚
4.  **è¨ªå•æ‡‰ç”¨**ï¼šç•¶ä¸€åˆ‡å°±ç·’å¾Œï¼ŒColab æœƒåœ¨è¼¸å‡ºå„²å­˜æ ¼çš„ä¸‹æ–¹ç”Ÿæˆä¸€å€‹å…§åµŒçš„æ‡‰ç”¨ç¨‹å¼è¦–çª—ï¼Œä¸¦åŒæ™‚æä¾›ä¸€å€‹å¯åœ¨æ–°åˆ†é é–‹å•Ÿçš„é€£çµã€‚

    > ğŸ‘‡ æ‚¨çš„æ‡‰ç”¨ç¨‹å¼æ­£åœ¨ä¸‹æ–¹å…§åµŒè¦–çª—ä¸­é‹è¡Œã€‚
    >
    > æˆ–è€…ï¼Œé»æ­¤åœ¨æ–°åˆ†é ä¸­å…¨è¢å¹•é–‹å•Ÿ

æ‚¨å¯ä»¥ç›´æ¥åœ¨å…§åµŒè¦–çª—ä¸­æ“ä½œï¼Œæˆ–é»æ“Šé€£çµä»¥ç²å¾—å…¨è¢å¹•é«”é©—ã€‚
